<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>THE LINKS. KTV BATAM - Karaoke Control</title>
<style>
/* === Tampilan Operator Asli === */
*{box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
body{margin:0;background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);color:#fff;overflow:hidden;}
header{padding:10px 20px;background:rgba(0,0,0,0.4);display:flex;align-items:center;justify-content:space-between;}
#searchBar{display:flex;gap:10px;align-items:center;}
input{padding:10px;border:none;border-radius:5px;width:300px;}
button{background:#1db954;border:none;color:#fff;padding:10px 15px;border-radius:5px;cursor:pointer;transition:0.2s;}
button:hover{background:#1ed760;}
#container{display:grid;grid-template-columns:1fr 1fr;height:calc(100vh - 180px);}
#searchResults,#playlist{overflow-y:auto;padding:15px;background:rgba(255,255,255,0.05);}
.song{display:flex;align-items:center;gap:10px;background:rgba(255,255,255,0.05);margin-bottom:8px;padding:8px;border-radius:6px;cursor:pointer;transition:0.2s;}
.song:hover{background:rgba(255,255,255,0.15);}
img.thumb{width:80px;border-radius:4px;}
.title{font-weight:bold;font-size:14px;}
.channel{font-size:12px;color:#ccc;}
#controls{display:flex;gap:10px;justify-content:center;padding:10px;background:rgba(0,0,0,0.3);}
#virtualKeyboard{display:none;grid-template-columns:repeat(10,1fr);gap:5px;padding:10px;background:rgba(0,0,0,0.3);position:absolute;bottom:10px;left:50%;transform:translateX(-50%);border-radius:10px;}
#virtualKeyboard button{background:#333;border:1px solid #444;color:#FFD700;font-weight:bold;}
#navButtons{display:flex;gap:5px;}

/* === QR Button === */
#qrToggleBtn{position:fixed;right:10px;bottom:10px;background:#FFD700;color:#000;font-weight:bold;border:none;border-radius:50%;width:45px;height:45px;cursor:pointer;z-index:1000;box-shadow:0 0 10px rgba(255,215,0,0.8);}
#qrPanel{position:fixed;right:10px;bottom:10px;background:rgba(0,0,0,0.6);padding:10px;border-radius:10px;z-index:999;display:flex;flex-direction:column;align-items:center;}
#qrcode{background:#fff;padding:8px;border-radius:6px;}
#qrLinkInput{width:250px;margin-bottom:8px;padding:6px;border:none;border-radius:5px;}
#closeQR{background:red;color:white;border:none;border-radius:4px;margin-top:6px;padding:3px 6px;cursor:pointer;}

/* === Tampilan Remote === */
#remoteUI{display:none;padding:20px;}
#remoteUI input{width:70%;max-width:420px;}
#remoteResults,#remotePlaylist{max-width:600px;margin:auto;margin-top:12px;text-align:left;}
.remoteSong{background:#203a43;padding:8px;margin:6px;border-radius:6px;cursor:pointer;}
.remoteSong:hover{background:#2c5364;}
#remoteControls{display:flex;gap:8px;justify-content:center;margin-top:12px;}
#remoteControls button{background:#FFD700;color:#000;font-weight:bold;padding:10px 12px;border-radius:6px;border:none;cursor:pointer;}
</style>
</head>
<body>

<!-- ================= Operator Layout ================= -->
<header id="operatorHeader">
  <div><strong>THE LINKS. KTV BATAM</strong></div>
  <div id="searchBar">
    <input type="text" id="searchInput" placeholder="Cari lagu..." />
    <button id="searchBtn">Cari</button>
    <div id="navButtons">
      <button id="upBtn">‚ñ≤</button>
      <button id="downBtn">‚ñº</button>
    </div>
    <button id="openPlayerBtn">Buka Layar 2</button>
  </div>
</header>

<div id="container">
  <div id="searchResults"></div>
  <div id="playlist"></div>
</div>

<div id="controls">
  <button onclick="playSelected()">Play</button>
  <button onclick="pauseVideo()">Pause</button>
  <button onclick="nextSong()">Next</button>
  <button onclick="clearPlaylist()">Clear</button>
</div>

<div id="virtualKeyboard"></div>

<!-- QR Section -->
<button id="qrToggleBtn">QR</button>
<div id="qrPanel" style="display:none;">
  <input id="qrLinkInput" placeholder="Masukkan link..." />
  <button id="generateQRBtn">Buat QR</button>
  <div id="qrcode"></div>
  <button id="closeQR">Tutup</button>
</div>

<!-- ================= Remote Layout ================= -->
<div id="remoteUI" aria-hidden="true">
  <h2 style="text-align:center;margin-top:12px;">üì± THE LINKS KTV - Remote</h2>
  <div style="text-align:center;margin-top:6px;">
    <input id="remoteSearch" placeholder="Cari lagu karaoke..." />
    <button id="remoteSearchBtn">Cari</button>
  </div>
  <div id="remoteResults"></div>

  <h3 style="text-align:center;margin-top:10px;">üéµ Playlist Saat Ini</h3>
  <div id="remotePlaylist"></div>

  <h3 style="text-align:center;margin-top:8px;">üéÆ Kontrol Pemutar</h3>
  <div id="remoteControls">
    <button data-action="play">‚ñ∂Ô∏è Play</button>
    <button data-action="pause">‚è∏Ô∏è Pause</button>
    <button data-action="next">‚è≠Ô∏è Next</button>
  </div>
</div>

<!-- Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js"></script>

<script>
/* ========= CONFIG ========= */
const firebaseConfig = {
  apiKey: "AIzaSyBnW5cUpoHzUpdN0UuVR5q8D7Epzuh46MY",
  authDomain: "karaoke-remote.firebaseapp.com",
  projectId: "karaoke-remote",
  storageBucket: "karaoke-remote.firebasestorage.app",
  messagingSenderId: "780368521995",
  appId: "1:780368521995:web:9175227e4529393d8f900e",
  measurementId: "G-6BFKKTY4CK",
  databaseURL: "https://karaoke-remote-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const API_KEY = "AIzaSyDRqyB5XtgdHTtDVbhuIR5cL6OqDTZlFgE";
const remoteURL = "https://supiyantoian-gif.github.io/?mode=remote";

const params = new URLSearchParams(window.location.search);
const isRemoteMode = params.get('mode') === 'remote';

/* ========= QR GENERATOR ========= */
const qrBtn = document.getElementById('qrToggleBtn');
const qrPanel = document.getElementById('qrPanel');
const qrDiv = document.getElementById('qrcode');
const qrInput = document.getElementById('qrLinkInput');
qrInput.value = remoteURL;
let qr;
function generateQR(link){
  qrDiv.innerHTML='';
  qr=new QRCode(qrDiv,{text:link,width:150,height:150});
}
generateQR(remoteURL);
qrBtn.onclick=()=>{qrPanel.style.display=qrPanel.style.display==='none'?'flex':'none';};
document.getElementById('generateQRBtn').onclick=()=>generateQR(qrInput.value);
document.getElementById('closeQR').onclick=()=>qrPanel.style.display='none';

/* ========= MODE SWITCH ========= */
if(isRemoteMode){
  document.getElementById('operatorHeader').style.display='none';
  document.getElementById('container').style.display='none';
  document.getElementById('controls').style.display='none';
  document.getElementById('qrToggleBtn').style.display='none';
  document.getElementById('qrPanel').style.display='none';
  document.getElementById('remoteUI').style.display='block';
}

/* ========= PLAYLIST SYNC ========= */
let playlist = [];
function renderPlaylist(){
  const p=document.getElementById('playlist');
  p.innerHTML='';
  playlist.forEach((s,i)=>{
    const div=document.createElement('div');
    div.className='song';
    div.innerHTML=`${i+1}. ${s.title}`;
    div.onclick=()=>{db.ref("karaoke/control").set({action:'play'});};
    p.appendChild(div);
  });
}
db.ref("karaoke/playlist").on("value",snap=>{
  playlist=snap.val()||[];
  renderPlaylist();
  renderRemotePlaylist();
});

/* ========= FIREBASE CONTROL ========= */
db.ref("karaoke/control").on("value",snap=>{
  const c=snap.val();
  if(!c)return;
  if(c.action==='play')console.log('‚ñ∂Ô∏è Play');
  if(c.action==='pause')console.log('‚è∏Ô∏è Pause');
  if(c.action==='next')console.log('‚è≠Ô∏è Next');
  setTimeout(()=>db.ref("karaoke/control").set(null),700);
});

/* ========= REMOTE MODE ========= */
const rSearch=document.getElementById('remoteSearch');
const rBtn=document.getElementById('remoteSearchBtn');
const rResults=document.getElementById('remoteResults');
const rPlaylist=document.getElementById('remotePlaylist');
rBtn.onclick=()=>doRemoteSearch();
async function doRemoteSearch(){
  const q=rSearch.value.trim();if(!q)return;
  rResults.innerHTML='<i>Mencari...</i>';
  const url=`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=8&q=${encodeURIComponent(q+' karaoke')}&key=${API_KEY}`;
  const res=await fetch(url);const data=await res.json();rResults.innerHTML='';
  (data.items||[]).forEach(item=>{
    const div=document.createElement('div');
    div.className='remoteSong';
    div.innerHTML=`<b>${item.snippet.title}</b><br><small>${item.snippet.channelTitle}</small>`;
    div.onclick=()=>{addToPlaylist(item.id.videoId,item.snippet.title);};
    rResults.appendChild(div);
  });
}
function addToPlaylist(id,title){
  db.ref("karaoke/playlist").once("value").then(snap=>{
    const list=snap.val()||[];
    list.push({id,title});
    db.ref("karaoke/playlist").set(list);
  });
}
function renderRemotePlaylist(){
  if(!isRemoteMode)return;
  rPlaylist.innerHTML='';
  playlist.forEach((s,i)=>{
    const div=document.createElement('div');
    div.className='remoteSong';
    div.textContent=`${i+1}. ${s.title}`;
    rPlaylist.appendChild(div);
  });
}
document.getElementById('remoteControls').onclick=(e)=>{
  const act=e.target.dataset.action;if(!act)return;
  db.ref("karaoke/control").set({action:act});
};
</script>
</body>
</html>
